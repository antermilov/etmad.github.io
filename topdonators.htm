<!doctype html>
<html>
  <head>
    
    

  </head>

  <body>

  <style>
  div{
  position:absolute; width:200px; background-color:#8888ee; height:40px;
  }
  .left{
  left:5px;
  width: 45%;
  background-color:transparent;
  }
  
  .right{
  right:5px;
  width: 45%;
  text-align: right;
  background-color:transparent;
  }
  </style>
  
  <div id="0" nick="none1" value="-1" style="top: 10px; "></div>
  <div id="1" nick="none2" value="-2" style="top: 60px; "></div>
  <div id="2" nick="none3" value="-3" style="top:110px; "></div>
  <div id="3" nick="none4" value="-4" style="top:160px; "></div>
  <div id="4" nick="none5" value="-5" style="top:210px; "></div>
  <div id="5" nick="" style="top:260px; "></div>
  <div id="6" nick="" style="top:310px; "></div>
  <div id="7" nick="" style="top:360px; "></div>
  <div id="8" nick="" style="top:410px; "></div>
  <div id="9" nick="" style="top:460px; "></div>
    
  
    
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    
<script type="text/javascript">
  
  setInterval( function(){
  
  $.get("http://etmad.github.io/twitchalerts.json", function(data){
    var don = data.donations;
	
  var a = d3.nest()
    .key(function(d) { return d.donator.name; })
    //.key(function(d) { return d.donator.name.toLowerCase(); })
    .rollup(function(v) { return d3.sum(v, function(d) { return d.amount; }); })
	.entries(don);
	
  var map = d3.nest()
    .key(function(d) { return d.donator.name; })
    //.key(function(d) { return d.donator.name.toLowerCase(); })
    .rollup(function(v) { return d3.sum(v, function(d) { return d.amount; }); })
	.map(don);
  
  map["none1"] = 0;
  map["none2"] = 0;
  map["none3"] = 0;
  map["none4"] = 0;
  map["none5"] = 0;
  
  a = a.sort(function(a, b) {
      return d3.descending(a.values, b.values);
  });
  
  //console.log(JSON.stringify(a));
  console.log(JSON.stringify(map));
  
  //wasa
  //wasmap
  
  var n = 5;
  //populate
  for(var i=0; i<n; i++){
  //if(!exist) => make (5+i)-th 
	var exist = false;
	for(var j=0;j<n;j++)
		exist |= (a[i].key === $("#"+j).attr("nick"));
  
	if(!exist) {
	$("#"+(5+i)).attr("nick",a[i].key);
	$("#"+(5+i)).attr("value",a[i].values);
	}
  }
  
  
  for(var j=0;j<n*2;j++){
	var who = $("#"+j).attr("nick");
	$("#"+j).attr("value", map[who]);
	$("#"+j).html("<div class='left'>"+who+"</div> <div class='right'>$"+map[who]+"</div>");
  }
  
  var np = [0,1,2,3,4,5,6,7,8,9];
  var used = [false, false, false, false, false, false, false, false, false, false];
  
  for(var i=0;i<n*2;i++){
  //choosing candidate for i-th place
  var max = -1;
  var npc = 0;
	for(var j=0;j<n*2;j++)
	if(!used[j])
		if(max<parseInt($("#"+j).attr("value")))
		{
			max = parseInt($("#"+j).attr("value"));
			npc = j;
		}
	
	used[npc] = true;
	np[i] = npc;
	
	}
	
	console.log(np);
	
	
	
	setTimeout( function(){
	for(var i=0;i<n*2;i++)
	  $("#"+i).animate({backgroundColor : "#8888ee"}, 3000);
	}, 5000);
	
	for(var i=0;i<n*2;i++){
	var j = np[i];
	if(i<j)
		$("#"+j).animate({top : "+="+((i-j)*50)+"px", backgroundColor : "#88e88e"}, 3000);
			
	if(i>j)
		$("#"+j).animate({top : "-="+((j-i)*50)+"px", backgroundColor : "#e8888e"}, 3000);
	//COLORIZE DAT SHIT
	}
	
	
    setTimeout( function(){
	for(var i=0;i<n*2;i++)
	 $("#"+i).attr("id","n"+np[i]);
	}, 8500);
	
	setTimeout( function(){
	for(var i=0;i<n*2;i++)
	 $("#n"+i).attr("id",""+i);
	}, 9000);
	
  
  
  //restore ids
  
  });
  
  }, 10000);
  
  </script>

  </body>
</html>
